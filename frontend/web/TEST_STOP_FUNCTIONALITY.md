# 停止功能测试指南

## 测试步骤

### 1. 启动Flask服务器
```bash
cd frontend/web
python app.py
```

### 2. 打开趋势页面
- 访问：`http://localhost:5000/trends`

### 3. 启动一个采集任务
1. 添加关键词（例如：`fitness`, `yoga`, `meditation`）
2. 选择平台：Google Trends
3. 选择时间范围：过去12个月
4. 点击"▶ 开始采集"按钮

### 4. 在采集过程中停止
1. 观察进度显示（应该显示"正在采集趋势数据..."）
2. 点击"⏹ 停止"按钮
3. 确认对话框，点击"确定"

### 5. 验证停止功能
**预期结果：**
- ✅ 显示确认对话框
- ✅ 点击确定后，任务状态变为"已停止"
- ✅ 停止按钮变为禁用状态（灰色）
- ✅ 状态指示器变为灰色
- ✅ 显示"采集任务已停止"消息
- ✅ 已采集的数据已保存到数据库

### 6. 检查数据库
- 已采集的部分数据应该已保存
- 可以刷新"已采集关键词"列表查看

## 测试场景

### 场景1：正常停止
- 启动任务 → 等待几秒 → 点击停止 → 验证状态

### 场景2：快速停止
- 启动任务 → 立即点击停止 → 验证状态

### 场景3：停止后重新启动
- 启动任务 → 停止 → 重新启动新任务 → 验证新任务正常

### 场景4：停止已完成的任务
- 等待任务完成 → 尝试点击停止 → 应该提示无法停止（按钮已禁用）

## 可能的问题

### 问题1：停止按钮没有响应
- **检查**：浏览器控制台是否有错误
- **检查**：后端API是否正常响应

### 问题2：停止后数据未保存
- **检查**：数据库中的趋势数据
- **检查**：后端日志输出

### 问题3：停止后状态显示不正确
- **检查**：前端是否正确处理 `stopped` 状态
- **检查**：状态指示器颜色是否正确

## 调试方法

### 查看后端日志
在Flask服务器终端查看输出：
```
[Trend Task trend_xxx] 任务已停止
```

### 查看前端控制台
打开浏览器开发者工具（F12），查看：
- Network标签：检查API请求和响应
- Console标签：查看JavaScript错误

### 检查API响应
```bash
# 检查任务状态
curl http://localhost:5000/api/v1/trends/status/trend_xxx

# 停止任务
curl -X POST http://localhost:5000/api/v1/trends/stop/trend_xxx
```
